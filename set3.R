Qd = solinput[1:n];Qd
[1] 16.17671 25.14682 52.13103 61.08384
Qs = solinput[(n+1):(2*n)];Qs
[1] 54.781546 52.338350  7.693446 39.725067
Ship = round(matrix(solinput[(2*n+1):(2*n+n**2)],nrow = n,byrow = TRUE),digits=3);Ship
       [,1]   [,2]   [,3]   [,4]
[1,] 16.177  0.000 17.246 21.359
[2,]  0.000 25.147 27.191  0.000
[3,]  0.000  0.000  7.693  0.000
[4,]  0.000  0.000  0.000 39.725

MCP:
Qd1 = solMCP[(2*n+1):(3*n)];Qd1
[1] 16.17834 25.13376 52.13376 61.08917
Qs1 = solMCP[(3*n+1):(4*n)];Qs1
[1] 54.777070 52.343949  7.694268 39.719745
Ship1 = round(matrix(solMCP[(4*n+1):(4*n+n**2)],nrow = n,byrow = TRUE),digits = 3);Ship1
       [,1]   [,2]   [,3]   [,4]
[1,] 16.178  0.000 17.229 21.369
[2,]  0.000 25.134 27.210  0.000
[3,]  0.000  0.000  7.694  0.000
[4,]  0.000  0.000  0.000 39.720


##Prob set #3

#run the program

##identify the quantity demanded, supplied, and traded for all regions. Briefly explain the trade patterns.

#*****************************************************************************
# Codes for Problem Set 3 for the Spatial Equilibrium Model
#*****************************************************************************
#Parameters
ALPHA = c(100,100,133,123) #Demand function intercepts q = f(p)
BETA = c(8,6,6,4) #Demand function slopes (absolute value) q = f(p)
OMEGA = c(-50,-35,-26,-16) #Supply function intercepts q = f(p)
GAMMA = c(10,7,2.5,3.6) #Supply function slopes q = f(p)
n = length(ALPHA) # number of regions
# Transport cost matrix
R1 = c(0,4,3,5)
R2 = c(4,0,1,3.1)
R3 = c(3,1,0,3.2)
R4 = c(5,3.1,3.2,0)
TC = matrix(c(R1,R2,R3,R4),nrow = n,byrow = TRUE)
# Converting the intercept and slope parameter in p = f(q) space
A = ALPHA/BETA # Demand function intercepts p = f(q)
B = 1/BETA # Demand function slopes p = f(q)
C = -OMEGA/GAMMA # Supply function intercepts p = f(q)
E = 1/GAMMA # Supply function slopes p = f(q)
###############################################
# NLP
###############################################
# function for objective function for NLP
fcnObj = function(x){
+   
+   Qd = x[1:n]
+   Qs = x[(n+1):(2*n)]
+   Ship = matrix(x[(2*n+1):(2*n+n**2)],nrow = n,byrow = TRUE)
+   
+   QUASIWELF = sum(A*Qd - (1/2)*B*(Qd**2) - C*Qs - (1/2)*E*(Qs**2)) - sum(TC*Ship)
+   2
+   
+   return(signf*QUASIWELF)
+ }
# function for constraints for NLP
SDConst = function(x){
+   # SDConst >= 0
+   Qd = x[1:n]
+   Qs = x[(n+1):(2*n)]
+   Ship = matrix(x[(2*n+1):(2*n+n**2)],nrow = n,byrow = TRUE)
+   
+   Dconst = colSums(Ship) - Qd
+   Sconst = Qs - rowSums(Ship)
+   
+   h1 = Qd
+   h2 = Qs
+   h3 = matrix(Ship,ncol = 1)
+   
+   return(c(Dconst,Sconst,h1,h2,h3))
+ }
library("alabama") # load "alabama" optimization package
stval = rep(1,24)
#stval = c(16,25,52,61,54,52,7,39,16,0,17,21,0,25,27,0,0,0,7,0,0,0,0,39)
signf = -1 # because 'auglag' is a minimization algorithm
solU = auglag(par = stval, fn = fcnObj, hin = SDConst)
Min(hin):  -3 
Outer iteration:  1 
Min(hin):  -3 
par:  1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 
fval =   -17.82 
 
Outer iteration:  2 
Min(hin):  -0.1639439 
par:  16.3051 25.2197 52.2238 61.1508 54.6253 52.2414 7.65841 39.663 16.0512 0.240059 17.4878 20.8601 0.119956 24.5487 27.3497 0.297024 0.120027 0.240021 7.13819 0.264038 0.000122522 0.117074 0.144011 39.5656 
fval =   -1344 
 
Outer iteration:  3 
Min(hin):  -0.0005577138 
par:  16.1772 25.147 52.1314 61.0843 54.7811 52.3381 7.69298 39.7244 16.1767 -0.000122261 17.2462 21.3586 7.39297e-05 25.1469 27.1913 4.75418e-05 -2.96725e-05 -5.69158e-05 7.69354 -9.49258e-06 -0.00017734 -0.000155861 -4.16112e-05 39.7253 
fval =   -1339 
 
Outer iteration:  4 
Min(hin):  -0.0003996248 
par:  16.177 25.1469 52.1313 61.0842 54.7812 52.3381 7.69311 39.7245 16.1768 -6.34431e-05 17.2462 21.3586 0.000115948 25.147 27.1913 4.99379e-05 4.54143e-06 -4.42376e-05 7.6935 -2.4213e-05 -0.000107331 -0.000122138 -8.02726e-05 39.7252 
fval =   -1339 
 
Outer iteration:  5 
Min(hin):  -0.00011165 
par:  16.1768 25.1467 52.1311 61.084 54.7815 52.3384 7.69337 39.7248 16.1767 -6.07686e-05 17.2462 21.3586 4.52732e-05 25.1469 27.1914 4.61576e-05 -9.23827e-06 -5.69576e-05 7.69349 -7.89199e-07 -6.94126e-05 -0.00011165 -6.9978e-05 39.7252 
fval =   -1339 
 
Outer iteration:  6 
Min(hin):  -0.0001082819 
par:  16.1767 25.1467 52.131 61.0839 54.7815 52.3384 7.69343 39.7249 16.1767 -3.63013e-05 17.2462 21.3587 3.72635e-05 25.1469 27.1914 6.68413e-05 9.76108e-06 -3.04594e-05 7.6935 3.94558e-05 -2.99169e-05 -7.08544e-05 -3.08915e-05 39.7252 
fval =   -1339 
 
Outer iteration:  7 
Min(hin):  -9.746009e-05 
par:  16.1767 25.1467 52.131 61.0839 54.7815 52.3384 7.69345 39.725 16.1767 -5.98618e-05 17.2462 21.3586 6.63724e-06 25.1469 27.1914 3.13405e-05 -2.32339e-05 -6.23852e-05 7.69346 -7.57216e-06 -5.76138e-05 -9.74601e-05 -6.70372e-05 39.7251 
fval =   -1339 
 
Outer iteration:  8 
Min(hin):  -1.135197e-05 
par:  16.1767 25.1468 52.131 61.0838 54.7815 52.3383 7.69344 39.7251 16.1767 -1.40089e-08 17.2462 21.3587 -1.1352e-05 25.1468 27.1914 0.00010923 1.58186e-06 1.8547e-06 7.69344 -5.27257e-06 2.22571e-06 2.9975e-06 5.13448e-06 39.7251 
fval =   -1339 
 
Outer iteration:  9 
Min(hin):  -9.617495e-06 
par:  16.1767 25.1468 52.131 61.0838 54.7815 52.3383 7.69344 39.7251 16.1767 2.5727e-07 17.2462 21.3587 -9.6175e-06 25.1468 27.1914 0.00010966 1.54696e-06 2.15398e-06 7.69345 -3.29909e-06 2.16598e-06 3.18155e-06 5.31489e-06 39.7251 
fval =   -1339 
 
Outer iteration:  10 
Min(hin):  -3.801966e-07 
par:  16.1767 25.1468 52.131 61.0838 54.7815 52.3384 7.69345 39.7251 16.1767 2.26223e-07 17.2462 21.3587 8.73436e-07 25.1468 27.1914 0.000101482 -3.80197e-07 -8.94891e-08 7.69345 2.96109e-07 -1.35864e-07 1.07639e-07 -3.47336e-07 39.7251 
fval =   -1339 
 
Outer iteration:  11 
Min(hin):  -9.644585e-07 
par:  16.1767 25.1468 52.131 61.0838 54.7815 52.3384 7.69345 39.7251 16.1767 1.83207e-07 17.2462 21.3587 3.2398e-07 25.1468 27.1914 0.000101159 2.43075e-07 2.50025e-08 7.69345 6.33465e-08 6.29128e-08 -1.63059e-07 -8.33771e-09 39.7251 
fval =   -1339 
 
Outer iteration:  12 
Min(hin):  -1.098661e-07 
par:  16.1767 25.1468 52.131 61.0838 54.7815 52.3383 7.69345 39.7251 16.1767 -4.5964e-08 17.2462 21.3587 3.79595e-08 25.1468 27.1914 0.000101408 1.05985e-07 -1.66068e-09 7.69345 3.44454e-08 3.57808e-09 -1.03275e-07 -4.49989e-08 39.7251 
fval =   -1339 
 
Outer iteration:  13 
Min(hin):  -1.708247e-07 
par:  16.1767 25.1468 52.131 61.0838 54.7815 52.3383 7.69345 39.7251 16.1767 -7.56201e-08 17.2462 21.3587 6.72495e-08 25.1468 27.1914 0.000101493 2.56239e-08 -1.20274e-08 7.69345 4.95207e-08 3.13732e-09 -3.45637e-08 -7.06998e-08 39.7251 
fval =   -1339 
 
Outer iteration:  14 
Min(hin):  -5.815874e-08 
par:  16.1767 25.1468 52.131 61.0838 54.7815 52.3383 7.69345 39.7251 16.1767 -3.92322e-08 17.2462 21.3587 4.04408e-08 25.1468 27.1914 0.000101444 5.41096e-08 -5.01899e-09 7.69345 3.73555e-08 1.08017e-09 -5.81587e-08 -3.71244e-08 39.7251 
fval =   -1339 
 
solinput = solU$par
round(solinput, digits=3)
 [1] 16.177 25.147 52.131 61.084 54.782 52.338  7.693 39.725 16.177  0.000 17.246 21.359  0.000 25.147 27.191  0.000  0.000  0.000  7.693  0.000
[21]  0.000  0.000  0.000 39.725
Qd = solinput[1:n];Qd
[1] 16.17671 25.14682 52.13103 61.08384
Qs = solinput[(n+1):(2*n)];Qs
[1] 54.781546 52.338350  7.693446 39.725067
Ship = round(matrix(solinput[(2*n+1):(2*n+n**2)],nrow = n,byrow = TRUE),digits=3);Ship
       [,1]   [,2]   [,3]   [,4]
[1,] 16.177  0.000 17.246 21.359
[2,]  0.000 25.147 27.191  0.000
[3,]  0.000  0.000  7.693  0.000
[4,]  0.000  0.000  0.000 39.725
Pd = A - B*Qd;Pd
[1] 10.47791 12.47553 13.47816 15.47904
Ps = C + E*Qs;Ps
[1] 10.47815 12.47691 13.47738 15.47919




###############################################
# MCP
###############################################
# function for MCP
fcnMCP = function(x){
+   RhoD = x[1:n]
+   3
+   RhoS = x[(n+1):(2*n)]
+   Qd = x[(2*n+1):(3*n)]
+   Qs = x[(3*n+1):(4*n)]
+   Ship = matrix(x[(4*n+1):(4*n+n**2)],nrow = n,byrow = TRUE)
+   
+   f1 = (RhoD - (A - B*Qd))*Qd
+   
+   f2 = (C + E*Qs - RhoS)*Qs
+   
+   k = 0;
+   f3 = rep(1,(n*n))
+   for(i in 1:n){
+     for(j in 1:n){
+       k = k + 1
+       f3[k] = (RhoS[i] + TC[i,j] - RhoD[j])*Ship[i,j]
+     }
+   }
+   
+   f4 = (colSums(Ship) - Qd)*RhoD
+   
+   f5 = (Qs - rowSums(Ship))*RhoS
+   
+   return(c(f1,f2,f3,f4,f5))
+ }
library("rootSolve") #load "rootSolve" package
xst = c(Pd,Ps,Qd,Qs,solinput[(2*n+1):(2*n+n**2)])
stval = xst
solMCPh = multiroot(fcnMCP, stval)
solMCP = solMCPh$root
RhoD1 = solMCP[1:n];RhoD1
[1] 10.47771 12.47771 13.47771 15.47771
RhoS1 = solMCP[(n+1):(2*n)];RhoS1
[1] 10.47771 12.47771 13.47771 15.47771
Qd1 = solMCP[(2*n+1):(3*n)];Qd1
[1] 16.17834 25.13376 52.13376 61.08917
Qs1 = solMCP[(3*n+1):(4*n)];Qs1
[1] 54.777070 52.343949  7.694268 39.719745
Ship1 = round(matrix(solMCP[(4*n+1):(4*n+n**2)],nrow = n,byrow = TRUE),digits = 3);Ship1
       [,1]   [,2]   [,3]   [,4]
[1,] 16.178  0.000 17.229 21.369
[2,]  0.000 25.134 27.210  0.000
[3,]  0.000  0.000  7.694  0.000
[4,]  0.000  0.000  0.000 39.720

